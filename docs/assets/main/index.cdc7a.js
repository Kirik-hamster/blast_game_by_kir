window.__require=function t(e,o,i){function r(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var d=o[s]={exports:{}};e[s][0].call(d.exports,function(t){return r(e[s][1][t]||t)},d,d.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({BonusService:[function(t,e,o){"use strict";cc._RF.push(e,"93ca2FZEihLpIhhT60klsGB","BonusService");var i=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{a(i.next(t))}catch(e){n(e)}}function c(t){try{a(i.throw(t))}catch(e){n(e)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(t){return function(e){return a([t,e])}}function a(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(c){n=[6,c],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./GameConfig"),s=function(){function t(t,e){this.controller=null,this.model=null,this.controller=t,this.model=e}return t.prototype.startWinBonus=function(){return i(this,void 0,void 0,function(){var t,e,o,i,s;return r(this,function(r){switch(r.label){case 0:this.controller.fieldBg.pauseSystemEvents(!0),r.label=1;case 1:return this.controller.currentMoves>0?(this.controller.currentMoves--,this.controller.updateUI(),t=Math.floor(Math.random()*this.model.rows),e=Math.floor(Math.random()*this.model.cols),o=this.model.gridData[t][e],this.controller.nodesGrid[t][e]&&-1!==this.controller.blockIndices.indexOf(o)?(i=n.GAME_CONFIG.FEVER_MODE.POSSIBLE_BOOSTERS,s=i[Math.floor(Math.random()*i.length)],this.controller.nodesGrid[t][e].destroy(),this.controller.spawnBooster(t,e,s),[4,new Promise(function(t){return setTimeout(t,n.GAME_CONFIG.FEVER_MODE.SPAWN_DELAY_MS)})]):[3,3]):[3,4];case 2:r.sent(),r.label=3;case 3:return[3,1];case 4:return this.activateAllBoostersSequentially(),[2]}})})},t.prototype.activateAllBoostersSequentially=function(){for(var t=this,e=null,o=0;o<this.model.rows;o++){for(var i=0;i<this.model.cols;i++){var r=this.model.gridData[o][i];if(-1!==[5,6,9,11].indexOf(r)){e={r:o,c:i,id:r};break}}if(e)break}e?(this.controller.activatePowerUp(e.r,e.c,e.id),this.controller.scheduleOnce(function(){return t.activateAllBoostersSequentially()},n.GAME_CONFIG.FEVER_MODE.EXPLOSION_INTERVAL)):this.controller.scheduleOnce(function(){t.controller.showEndGame(!0)},n.GAME_CONFIG.FEVER_MODE.FINAL_UI_DELAY)},t}();o.default=s,cc._RF.pop()},{"./GameConfig":"GameConfig"}],BoosterService:[function(t,e,o){"use strict";cc._RF.push(e,"148867YHAdOxa4T7FXDPaL+","BoosterService"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.getAffectedArea=function(t,e,o,i,r){var n=[];switch(t){case this.ROCKET_H:for(var s=0;s<r;s++)n.push({r:e,c:s});break;case this.ROCKET_V:for(s=0;s<i;s++)n.push({r:s,c:o});break;case this.BOMB:this.addFixedArea(n,e,o,1,i,r),this.addRandomPositions(n,e,o,2,2,5,i,r);break;case this.BOMB_MAX:this.addFixedArea(n,e,o,2,i,r),this.addRandomPositions(n,e,o,3,3,10,i,r)}return n},t.addFixedArea=function(t,e,o,i,r,n){for(var s=-i;s<=i;s++)for(var c=-i;c<=i;c++){var a=e+s,l=o+c;a>=0&&a<r&&l>=0&&l<n&&t.push({r:a,c:l})}},t.addRandomPositions=function(t,e,o,i,r,n,s,c){for(var a=[],l=-i;l<=i;l++)for(var d=function(i){var r=e+l,n=o+i;r>=0&&r<s&&n>=0&&n<c&&(t.some(function(t){return t.r===r&&t.c===n})||a.push({r:r,c:n}))},h=-r;h<=r;h++)d(h);for(var u=0;u<n&&a.length>0;u++){var f=Math.floor(Math.random()*a.length),p=a.splice(f,1)[0];t.push(p)}},t.ROCKET_H=11,t.ROCKET_V=9,t.BOMB=5,t.BOMB_MAX=6,t}();o.default=i,cc._RF.pop()},{}],GameConfig:[function(t,e,o){"use strict";cc._RF.push(e,"42e54zvhpRG1byfxxqX+HQi","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GAME_CONFIG=void 0,o.GAME_CONFIG={START_MOVES:27,TARGET_SCORE:500,AUTO_SHUFFLE_LIMIT:3,INITIAL_TELEPORT_COUNT:3,INITIAL_BOMB_COUNT:3,MIN_MATCH_SIZE:4,HINT_DELAY:5,THRESHOLDS:{ROCKET:{min:6,max:7},BOMB_SMALL:{min:8,max:11},BOMB_MAX:{min:12,max:99}},POINTS_PER_NORMAL_TILE:1,BOOSTER_EXPLOSION_DIVIDER:2,GRAVITY_DELAY:.1,CHECK_STATE_DELAY:.5,FALL_DURATION:.4,FEVER_MODE:{SPAWN_DELAY_MS:500,EXPLOSION_INTERVAL:1.8,FINAL_UI_DELAY:1.5,POSSIBLE_BOOSTERS:[5,6,9,11]}},cc._RF.pop()},{}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"17e8bLdcKRA97YWhVJ5z1t1","GameController");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./GridModel"),c=t("./BoosterService"),a=t("./HintService"),l=t("./BonusService"),d=t("./GameConfig"),h=cc._decorator,u=h.ccclass,f=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soundSmall=null,e.soundBig=null,e.rocket=null,e.bombSmall=null,e.bombBig=null,e.soundWin=null,e.soundLose=null,e.soundShuffle=null,e.gameplayUI=null,e.endGameUI=null,e.endGameLable=null,e.restartButtonNode=null,e.ScoreCount=null,e.movesLabel=null,e.endGameScoreLabel=null,e.tilePrefab=null,e.fieldBg=null,e.tileTextures=[],e.btnTeleport=null,e.btnRandomBomb=null,e.teleportLabel=null,e.boosterBombLabel=null,e.model=null,e.hintService=null,e.bonusService=null,e.nodesGrid=[],e.currentMoves=d.GAME_CONFIG.START_MOVES,e.teleportCount=d.GAME_CONFIG.INITIAL_TELEPORT_COUNT,e.boosterBombCount=d.GAME_CONFIG.INITIAL_BOMB_COUNT,e.currentScore=0,e.targetScore=d.GAME_CONFIG.TARGET_SCORE,e.isTeleportActive=!1,e.firstSelectedTile=null,e.autoShuffleCount=0,e.rows=10,e.cols=9,e.spacingX=100,e.spacingY=100,e.blockIndices=[4,7,8,10,12],e.rocketIndices=[9,11],e.bombIdx=5,e.maxBombIdx=6,e.isEndingStarted=!1,e}return r(e,t),e.prototype.start=function(){this.isEndingStarted=!1,this.model=new s.default(this.rows,this.cols),this.bonusService=new l.default(this,this.model),this.hintService=new a.default(this,this.model,this.blockIndices),this.gameplayUI&&(this.gameplayUI.active=!0),this.endGameUI&&(this.endGameUI.active=!1),this.updateUI(),this.generateField(),this.setupEventListeners(),this.hintService.resetTimer()},e.prototype.setupEventListeners=function(){var t=this;this.btnTeleport&&this.btnTeleport.on(cc.Node.EventType.TOUCH_END,function(e){t.teleportCount<=0||(t.isTeleportActive?(t.isTeleportActive=!1,t.btnTeleport.color=cc.Color.WHITE,t.firstSelectedTile&&(cc.tween(t.firstSelectedTile.node).to(.1,{scale:1}).start(),t.firstSelectedTile=null),cc.log("\u0422\u0415\u041b\u0415\u041f\u041e\u0420\u0422: \u0420\u0435\u0436\u0438\u043c \u043e\u0442\u043c\u0435\u043d\u0435\u043d \u0438\u0433\u0440\u043e\u043a\u043e\u043c")):(t.isTeleportActive=!0,t.btnTeleport.color=cc.Color.YELLOW,cc.log("\u0422\u0415\u041b\u0415\u041f\u041e\u0420\u0422: \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0435\u0440\u0432\u044b\u0439 \u0442\u0430\u0439\u043b")),e.stopPropagation())}),this.btnRandomBomb&&this.btnRandomBomb.on(cc.Node.EventType.TOUCH_END,function(e){t.boosterBombCount>0&&(t.btnRandomBomb.color=cc.Color.YELLOW,t.scheduleOnce(function(){t.useRandomBombBooster(),t.boosterBombCount>0&&(t.btnRandomBomb.color=cc.Color.WHITE)},.1)),e.stopPropagation()}),this.restartButtonNode&&this.restartButtonNode.on(cc.Node.EventType.TOUCH_END,function(){return t.restartGame()})},e.prototype.handleTeleportSwap=function(t,e){var o=this,i=this.nodesGrid[t][e];if(!this.firstSelectedTile)return this.firstSelectedTile={r:t,c:e,node:i},cc.tween(i).to(.15,{scale:1.2}).start(),void cc.log("\u041f\u0435\u0440\u0432\u044b\u0439 \u043a\u0443\u0431\u0438\u043a \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d. \u0416\u0434\u0435\u043c \u0432\u0442\u043e\u0440\u043e\u0439.");var r=this.firstSelectedTile;if(r.r===t&&r.c===e)return cc.tween(r.node).to(.1,{scale:1}).start(),this.btnTeleport.color=cc.Color.WHITE,this.firstSelectedTile=null,this.isTeleportActive=!1,void cc.log("\u0422\u0435\u043b\u0435\u043f\u043e\u0440\u0442 \u043e\u0442\u043c\u0435\u043d\u0435\u043d");var n=this.model.gridData[r.r][r.c];this.model.gridData[r.r][r.c]=this.model.gridData[t][e],this.model.gridData[t][e]=n;var s=r.node.getPosition(),c=i.getPosition();cc.tween(r.node).to(.3,{x:c.x,y:c.y,scale:1}).start(),cc.tween(i).to(.3,{x:s.x,y:s.y}).start(),this.nodesGrid[r.r][r.c]=i,this.nodesGrid[t][e]=r.node,r.node.off(cc.Node.EventType.TOUCH_END),i.off(cc.Node.EventType.TOUCH_END),r.node.on(cc.Node.EventType.TOUCH_END,function(){return o.onTileClick(t,e)}),i.on(cc.Node.EventType.TOUCH_END,function(){return o.onTileClick(r.r,r.c)}),this.teleportCount--,this.isTeleportActive=!1,this.btnTeleport&&(this.btnTeleport.color=cc.Color.WHITE),this.firstSelectedTile=null,this.updateUI(),this.scheduleOnce(function(){return o.checkGameState()},.4)},e.prototype.generateField=function(){this.model.initGrid(),this.nodesGrid.length=0,this.fieldBg.removeAllChildren();for(var t=0;t<this.rows;t++){this.nodesGrid[t]=[];for(var e=0;e<this.cols;e++)this.spawnTile(t,e)}},e.prototype.spawnTile=function(t,e){var o=this,i=cc.instantiate(this.tilePrefab);i.parent=this.fieldBg,i.setContentSize(100,112);var r=this.getSmartColor(t,e);this.model.gridData[t][e]=r,i.colorID=r,i.setPosition(100*(e-(this.cols-1)/2),100*(t-(this.rows-1)/2)),i.getComponent(cc.Sprite).spriteFrame=this.tileTextures[r],i.on(cc.Node.EventType.TOUCH_END,function(){return o.onTileClick(t,e)}),this.nodesGrid[t][e]=i},e.prototype.onTileClick=function(t,e){var o=this;if(this.hintService&&this.hintService.resetTimer(),this.isTeleportActive)this.handleTeleportSwap(t,e);else{var i=this.model.gridData[t][e],r=this.model.findMatches(t,e,i);-1===this.rocketIndices.indexOf(i)&&i!==this.bombIdx&&i!==this.maxBombIdx?(r.forEach(function(t){var e=o.nodesGrid[t.r][t.c];e&&cc.tween(e).to(.05,{scale:1.1}).to(.05,{scale:1}).start()}),r.length<d.GAME_CONFIG.MIN_MATCH_SIZE||this.scheduleOnce(function(){r.length>5?cc.audioEngine.playEffect(o.soundBig,!1):cc.audioEngine.playEffect(o.soundSmall,!1),o.currentMoves--,o.currentScore+=r.length*d.GAME_CONFIG.POINTS_PER_NORMAL_TILE,r.forEach(function(t){var e=o.nodesGrid[t.r][t.c];e&&(e.destroy(),o.nodesGrid[t.r][t.c]=null,o.model.gridData[t.r][t.c]=-1)});var i=-1;r.length>=d.GAME_CONFIG.THRESHOLDS.ROCKET.min&&r.length<=d.GAME_CONFIG.THRESHOLDS.ROCKET.max?i=o.rocketIndices[Math.floor(2*Math.random())]:r.length>=d.GAME_CONFIG.THRESHOLDS.BOMB_SMALL.min&&r.length<=d.GAME_CONFIG.THRESHOLDS.BOMB_SMALL.max?i=o.bombIdx:r.length>=12&&(i=o.maxBombIdx),-1!==i&&o.spawnBooster(t,e,i),o.updateUI(),o.scheduleOnce(function(){return o.applyGravity()},d.GAME_CONFIG.GRAVITY_DELAY)},.1)):this.activatePowerUp(t,e,i)}},e.prototype.checkGameState=function(){var t=this;if(!this.isEndingStarted)if(this.currentScore>=this.targetScore)this.bonusService.startWinBonus();else{if(!this.model.hasPossibleMatches(this.blockIndices,d.GAME_CONFIG.MIN_MATCH_SIZE))return this.autoShuffleCount<d.GAME_CONFIG.AUTO_SHUFFLE_LIMIT?(this.autoShuffleCount++,this.executeShuffleLogic(),void this.scheduleOnce(function(){return t.checkGameState()},3)):void this.showEndGame(!1);this.currentMoves<=0&&this.showEndGame(!1)}},e.prototype.executeShuffleLogic=function(){var t=this;this.soundShuffle&&cc.audioEngine.playEffect(this.soundShuffle,!1);for(var e=[],o=0;o<this.rows;o++)for(var i=0;i<this.cols;i++)this.nodesGrid[o][i]&&e.push(this.nodesGrid[o][i]);e.forEach(function(t){cc.tween(t).to(1.2,{scale:0,angle:720},{easing:"backIn"}).delay(.2).to(1.3,{scale:1,angle:0},{easing:"backOut"}).start()}),this.scheduleOnce(function(){for(var e,o=[],i=0;i<t.rows;i++)for(var r=0;r<t.cols;r++)t.nodesGrid[i][r]&&o.push(t.model.gridData[i][r]);for(var n=o.length-1;n>0;n--){var s=Math.floor(Math.random()*(n+1));e=[o[s],o[n]],o[n]=e[0],o[s]=e[1]}var c=0;for(i=0;i<t.rows;i++)for(r=0;r<t.cols;r++)if(t.nodesGrid[i][r]){var a=o[c++];t.model.gridData[i][r]=a,t.nodesGrid[i][r].getComponent(cc.Sprite).spriteFrame=t.tileTextures[a]}},1.3)},e.prototype.showEndGame=function(t){this.endGameUI&&this.endGameUI.active||(t?cc.audioEngine.playEffect(this.soundWin,!1):cc.audioEngine.playEffect(this.soundLose,!1),this.gameplayUI&&(this.gameplayUI.active=!1),this.endGameUI&&(this.endGameUI.active=!0),this.endGameLable&&(this.endGameLable.string=t?"\u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438, \u0445\u043e\u0442\u0438\u0442\u0435 \n \u043d\u0430\u0447\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0438\u0433\u0440\u0443?":"\u0412\u044b \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043b\u0438, \u0445\u043e\u0442\u0438\u0442\u0435 \n \u043d\u0430\u0447\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0438\u0433\u0440\u0443?"),this.endGameScoreLabel&&(this.endGameScoreLabel.string=this.currentScore+"/"+this.targetScore))},e.prototype.restartGame=function(){cc.director.loadScene(cc.director.getScene().name)},e.prototype.updateUI=function(){this.ScoreCount&&(this.ScoreCount.string=this.currentScore+"/"+this.targetScore),this.movesLabel&&(this.movesLabel.string=this.currentMoves.toString()),this.teleportLabel&&(this.teleportLabel.string=this.teleportCount.toString()),this.boosterBombLabel&&(this.boosterBombLabel.string=this.boosterBombCount.toString()),this.btnTeleport&&this.teleportCount<=0&&(this.btnTeleport.opacity=150,this.btnTeleport.color=cc.Color.GRAY),this.btnRandomBomb&&this.boosterBombCount<=0&&(this.btnRandomBomb.opacity=150,this.btnRandomBomb.color=cc.Color.GRAY)},e.prototype.getSmartColor=function(t,e){var o=[];return t>0&&void 0!==this.model.gridData[t-1][e]&&o.push(this.model.gridData[t-1][e]),e>0&&void 0!==this.model.gridData[t][e-1]&&o.push(this.model.gridData[t][e-1]),o.length>0&&Math.random()<.6?o[Math.floor(Math.random()*o.length)]:this.blockIndices[Math.floor(Math.random()*this.blockIndices.length)]},e.prototype.useShuffleBooster=function(){var t;if(!(this.teleportCount<=0)){for(var e=[],o=0;o<this.rows;o++)for(var i=0;i<this.cols;i++)this.nodesGrid[o][i]&&e.push(this.model.gridData[o][i]);for(var r=e.length-1;r>0;r--){var n=Math.floor(Math.random()*(r+1));t=[e[n],e[r]],e[r]=t[0],e[n]=t[1]}var s=0;for(o=0;o<this.rows;o++)for(i=0;i<this.cols;i++)if(this.nodesGrid[o][i]){var c=e[s++];this.model.gridData[o][i]=c,this.nodesGrid[o][i].getComponent(cc.Sprite).spriteFrame=this.tileTextures[c]}this.teleportCount--,this.updateUI()}},e.prototype.useRandomBombBooster=function(){if(!(this.boosterBombCount<=0)){this.isTeleportActive&&(this.isTeleportActive=!1,this.btnTeleport&&(this.btnTeleport.color=cc.Color.WHITE),this.firstSelectedTile&&(cc.tween(this.firstSelectedTile.node).to(.1,{scale:1}).start(),this.firstSelectedTile=null));var t=Math.floor(Math.random()*this.rows),e=Math.floor(Math.random()*this.cols);this.nodesGrid[t][e]&&(this.nodesGrid[t][e].destroy(),this.spawnBooster(t,e,this.bombIdx),this.boosterBombCount--,this.updateUI())}},e.prototype.removeTileFromGrid=function(t){for(var e=0;e<this.rows;e++){var o=this.nodesGrid[e].indexOf(t);if(-1!==o)return this.nodesGrid[e][o]=null,void(this.model.gridData[e][o]=-1)}},e.prototype.spawnBooster=function(t,e,o){var i=this,r=cc.instantiate(this.tilePrefab);r.parent=this.fieldBg,r.setContentSize(100,112),r.colorID=o,this.model.gridData[t][e]=o,this.soundSmall&&cc.audioEngine.playEffect(this.soundSmall,!1),r.setPosition((e-(this.cols-1)/2)*this.spacingX,(t-(this.rows-1)/2)*this.spacingY),r.getComponent(cc.Sprite).spriteFrame=this.tileTextures[o],r.on(cc.Node.EventType.TOUCH_END,function(){return i.onTileClick(t,e)}),this.nodesGrid[t][e]=r},e.prototype.playBoosterSfx=function(t){-1!==this.rocketIndices.indexOf(t)?cc.audioEngine.playEffect(this.rocket,!1):t===this.bombIdx?cc.audioEngine.playEffect(this.bombSmall,!1):t===this.maxBombIdx&&cc.audioEngine.playEffect(this.bombBig,!1)},e.prototype.shakeNode=function(t,e){if(void 0===e&&(e=10),t){var o=t.getPosition();cc.tween(t).to(.05,{position:cc.v3(o.x+e,o.y+e,0)}).to(.05,{position:cc.v3(o.x-e,o.y-e,0)}).to(.05,{position:cc.v3(o.x+e,o.y-e,0)}).to(.05,{position:cc.v3(o.x,o.y,0)}).start()}},e.prototype.activatePowerUp=function(t,e,o){var i=this,r=[{r:t,c:e,id:o}],n=[],s=new Set;for(9===o||11===o?cc.audioEngine.playEffect(this.rocket,!1):o===this.bombIdx?cc.audioEngine.playEffect(this.bombSmall,!1):o===this.maxBombIdx&&cc.audioEngine.playEffect(this.bombBig,!1);r.length>0;){var a=r.shift(),l=a.r+","+a.c;s.has(l)||(s.add(l),a.id===this.bombIdx?this.shakeNode(this.fieldBg,10):a.id===this.maxBombIdx&&this.shakeNode(this.gameplayUI,30),this.playBoosterSfx(a.id),c.default.getAffectedArea(a.id,a.r,a.c,this.rows,this.cols).forEach(function(t){if(i.model.isPosValid(t.r,t.c)){n.some(function(e){return e.r===t.r&&e.c===t.c})||n.push(t);var e=i.model.gridData[t.r][t.c],o=-1!==i.rocketIndices.indexOf(e),c=e===i.bombIdx||e===i.maxBombIdx;!o&&!c||s.has(t.r+","+t.c)||r.push({r:t.r,c:t.c,id:e})}}))}n.length>0&&n.forEach(function(t){i.currentScore+=d.GAME_CONFIG.BOOSTER_EXPLOSION_DIVIDER;var e=i.nodesGrid[t.r][t.c];e&&(e.destroy(),i.nodesGrid[t.r][t.c]=null,i.model.gridData[t.r][t.c]=-1)}),this.updateUI(),this.scheduleOnce(function(){return i.applyGravity()},.1)},e.prototype.addRandomTargets=function(t,e,o,i,r){for(var n=[],s=-o;s<=o;s++)for(var c=-o;c<=o;c++){var a=t+s,l=e+c;this.model.isPosValid(a,l)&&this.nodesGrid[a][l]&&-1===r.indexOf(this.nodesGrid[a][l])&&n.push(this.nodesGrid[a][l])}for(var d=0;d<i&&n.length>0;d++){var h=Math.floor(Math.random()*n.length);r.push(n.splice(h,1)[0])}},e.prototype.applyGravity=function(){for(var t=this,e=function(e){for(var i=0,r=function(r){if(null===o.nodesGrid[r][e])i++;else if(i>0){var n=o.nodesGrid[r][e],s=r-i;o.nodesGrid[s][e]=n,o.model.gridData[s][e]=o.model.gridData[r][e],o.nodesGrid[r][e]=null,o.model.gridData[r][e]=-1;var c=(s-(o.rows-1)/2)*o.spacingY;cc.tween(n).to(d.GAME_CONFIG.FALL_DURATION,{y:c},{easing:"bounceOut"}).start(),n.off(cc.Node.EventType.TOUCH_END),n.on(cc.Node.EventType.TOUCH_END,function(){return t.onTileClick(s,e)})}},n=0;n<o.rows;n++)r(n);o.fillEmptyTop(e,i)},o=this,i=0;i<this.cols;i++)e(i);this.scheduleOnce(function(){t.checkGameState(),t.hintService&&t.hintService.resetTimer()},d.GAME_CONFIG.CHECK_STATE_DELAY)},e.prototype.fillEmptyTop=function(t,e){for(var o=this,i=function(i){var n=r.rows-e+i,s=cc.instantiate(r.tilePrefab);s.parent=r.fieldBg,s.setContentSize(100,112);var c=r.blockIndices[Math.floor(Math.random()*r.blockIndices.length)];s.colorID=c;var a=s.getComponent(cc.Sprite);a.spriteFrame=r.tileTextures[c],a.sizeMode=cc.Sprite.SizeMode.CUSTOM;var l=(t-(r.cols-1)/2)*r.spacingX,h=(r.rows+i-(r.rows-1)/2)*r.spacingY,u=(n-(r.rows-1)/2)*r.spacingY;s.setPosition(l,h),cc.tween(s).to(d.GAME_CONFIG.FALL_DURATION,{y:u},{easing:"bounceOut"}).start(),s.on(cc.Node.EventType.TOUCH_END,function(){return o.onTileClick(n,t)}),r.model.gridData[n][t]=c,r.nodesGrid[n][t]=s},r=this,n=0;n<e;n++)i(n)},n([f(cc.AudioClip)],e.prototype,"soundSmall",void 0),n([f(cc.AudioClip)],e.prototype,"soundBig",void 0),n([f(cc.AudioClip)],e.prototype,"rocket",void 0),n([f(cc.AudioClip)],e.prototype,"bombSmall",void 0),n([f(cc.AudioClip)],e.prototype,"bombBig",void 0),n([f(cc.AudioClip)],e.prototype,"soundWin",void 0),n([f(cc.AudioClip)],e.prototype,"soundLose",void 0),n([f(cc.AudioClip)],e.prototype,"soundShuffle",void 0),n([f(cc.Node)],e.prototype,"gameplayUI",void 0),n([f(cc.Node)],e.prototype,"endGameUI",void 0),n([f(cc.Label)],e.prototype,"endGameLable",void 0),n([f(cc.Node)],e.prototype,"restartButtonNode",void 0),n([f(cc.Label)],e.prototype,"ScoreCount",void 0),n([f(cc.Label)],e.prototype,"movesLabel",void 0),n([f(cc.Label)],e.prototype,"endGameScoreLabel",void 0),n([f(cc.Prefab)],e.prototype,"tilePrefab",void 0),n([f(cc.Node)],e.prototype,"fieldBg",void 0),n([f([cc.SpriteFrame])],e.prototype,"tileTextures",void 0),n([f(cc.Node)],e.prototype,"btnTeleport",void 0),n([f(cc.Node)],e.prototype,"btnRandomBomb",void 0),n([f(cc.Label)],e.prototype,"teleportLabel",void 0),n([f(cc.Label)],e.prototype,"boosterBombLabel",void 0),n([u],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./BonusService":"BonusService","./BoosterService":"BoosterService","./GameConfig":"GameConfig","./GridModel":"GridModel","./HintService":"HintService"}],GridModel:[function(t,e,o){"use strict";cc._RF.push(e,"7176eBnbtxNxb5MEIvIUayn","GridModel"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t,e){this.rows=10,this.cols=9,this.gridData=[],this.rows=t,this.cols=e}return t.prototype.initGrid=function(){this.gridData=[];for(var t=0;t<this.rows;t++)this.gridData[t]=[]},t.prototype.isPosValid=function(t,e){return t>=0&&t<this.rows&&e>=0&&e<this.cols},t.prototype.findMatches=function(t,e,o,i){void 0===i&&(i=new Set);var r=t+","+e;if(!this.isPosValid(t,e)||i.has(r)||this.gridData[t][e]!==o)return[];i.add(r);var n=[{r:t,c:e}];return n.push.apply(n,this.findMatches(t+1,e,o,i)),n.push.apply(n,this.findMatches(t-1,e,o,i)),n.push.apply(n,this.findMatches(t,e+1,o,i)),n.push.apply(n,this.findMatches(t,e-1,o,i)),n},t.prototype.hasPossibleMatches=function(t,e){for(var o=new Set,i=0;i<this.rows;i++)for(var r=0;r<this.cols;r++){var n=i+","+r;if(!o.has(n)){var s=this.gridData[i][r];if(-1===t.indexOf(s))return!0;var c=this.findMatches(i,r,s,new Set);if(c.length>=e)return!0;c.forEach(function(t){return o.add(t.r+","+t.c)})}}return!1},t}();o.default=i,cc._RF.pop()},{}],HintService:[function(t,e,o){"use strict";cc._RF.push(e,"29b935Wy4FAjrHOp2gdpXIy","HintService"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./GameConfig"),r=function(){function t(t,e,o){this.controller=null,this.model=null,this.blockIndices=[],this.hintNodes=[],this.boundShowHint=null,this.controller=t,this.model=e,this.blockIndices=o,this.boundShowHint=this.showHint.bind(this)}return t.prototype.resetTimer=function(){this.stopHint(),this.controller.unschedule(this.boundShowHint),this.controller.scheduleOnce(this.boundShowHint,i.GAME_CONFIG.HINT_DELAY)},t.prototype.showHint=function(){var t=this,e=this.controller.nodesGrid;if(e&&0!==e.length){for(var o=[],r=function(t){for(var e=function(e){var r=n.model.gridData[t][e];if(-1===r||-1===n.blockIndices.indexOf(r))return"continue";if(o.some(function(o){return o.some(function(o){return o.r===t&&o.c===e})}))return"continue";var s=n.model.findMatches(t,e,r,new Set);s&&s.length>=i.GAME_CONFIG.MIN_MATCH_SIZE&&o.push(s)},r=0;r<n.model.cols;r++)e(r)},n=this,s=0;s<this.model.rows;s++)r(s);if(o.length>0){var c=o[Math.floor(Math.random()*o.length)];c.forEach(function(o,i){if(e[o.r]&&e[o.r][o.c]){var r=e[o.r][o.c];t.hintNodes.push(r),cc.tween(r).to(.4,{scale:1.1},{easing:"sineInOut"}).to(.4,{scale:1},{easing:"sineInOut"}).union().repeat(5).call(function(){i===c.length-1&&t.resetTimer()}).start()}})}else this.resetTimer()}},t.prototype.stopHint=function(){this.hintNodes.forEach(function(t){t&&t.isValid&&(cc.tween(t).stop(),t.scale=1)}),this.hintNodes=[]},t}();o.default=r,cc._RF.pop()},{"./GameConfig":"GameConfig"}]},{},["BonusService","BoosterService","GameConfig","GameController","GridModel","HintService"]);